colour="black", alpha=0.5) +
stat_summary(aes(size=countYearMonth),fun.y=mean, geom="point") +
coord_cartesian(ylim=c(2.5,4.5)) +
scale_size_continuous(range=c(3,8)) +
theme(axis.text.x =element_text(angle=90))
global_p4
global_p4 <- ggplot(CapstoneDF, aes(x=YearMonth, y=Ratings, col=QuarterGroup)) +
geom_line(aes(y=RatingsAvg, group=1), linetype="dashed",
colour="black", alpha=0.5) +
stat_summary(aes(size=countYearMonth),fun.y=mean, geom="point", alpha=0.5) +
coord_cartesian(ylim=c(2.5,4.5)) +
scale_size_continuous(range=c(3,8)) +
theme(axis.text.x =element_text(angle=90))
global_p4
global_p4 <- ggplot(CapstoneDF, aes(x=YearMonth, y=Ratings, col=QuarterGroup)) +
geom_line(aes(y=RatingsAvg, group=1), linetype="dashed",
colour="black", alpha=0.5) +
stat_summary(aes(size=countYearMonth),fun.y=mean, geom="point", alpha=0.8) +
coord_cartesian(ylim=c(2.5,4.5)) +
scale_size_continuous(range=c(3,8)) +
theme(axis.text.x =element_text(angle=90))
global_p4
global_p4 <- ggplot(CapstoneDF, aes(x=YearMonth, y=Ratings, col=Year)) +
geom_line(aes(y=RatingsAvg, group=1), linetype="dashed",
colour="black", alpha=0.5) +
stat_summary(aes(size=countYearMonth),fun.y=mean, geom="point", alpha=0.8) +
coord_cartesian(ylim=c(2.5,4.5)) +
scale_size_continuous(range=c(3,8)) +
theme(axis.text.x =element_text(angle=90))
global_p4
#Ratings aggregated by Year
global_p1 <- ggplot(CapstoneDF, aes(x=Year, y=Ratings)) +
geom_line(aes(y=RatingsAvg, group=1), linetype="dashed",
colour="red", alpha=0.5) +
stat_summary(aes(size=countYear), fun.y=mean, geom="point") +
#coord_cartesian(ylim=c(2.5,4.5)) +
scale_size_continuous(range=c(3,9)) +
coord_cartesian(ylim=c(3.0,4.5))
global_p1
#Ratings aggregated by Year
global_p1 <- ggplot(CapstoneDF, aes(x=Year, y=Ratings)) +
geom_line(aes(y=RatingsAvg, group=1), linetype="dashed",
colour="red", alpha=0.5) +
stat_summary(aes(size=countYear), fun.y=mean, geom="point") +
#coord_cartesian(ylim=c(2.5,4.5)) +
scale_size_continuous(range=c(3,7)) +
coord_cartesian(ylim=c(3.0,4.5))
global_p1
#Ratings aggregated by Year
global_p1 <- ggplot(CapstoneDF, aes(x=Year, y=Ratings, col=Year)) +
geom_line(aes(y=RatingsAvg, group=1), linetype="dashed",
colour="red", alpha=0.5) +
stat_summary(aes(size=countYear), fun.y=mean, geom="point") +
#coord_cartesian(ylim=c(2.5,4.5)) +
scale_size_continuous(range=c(3,7)) +
coord_cartesian(ylim=c(3.0,4.5))
global_p1
#Ratings aggregated by Year
global_p1 <- ggplot(CapstoneDF, aes(x=Year, y=Ratings)) +
geom_line(aes(y=RatingsAvg, group=1), linetype="dashed",
colour="red", alpha=0.5) +
stat_summary(aes(size=countYear), fun.y=mean, geom="point") +
#coord_cartesian(ylim=c(2.5,4.5)) +
scale_size_continuous(range=c(3,7)) +
coord_cartesian(ylim=c(3.0,4.5))
global_p1
#Ratings aggregated by Year and Quarters
global_p2 <- ggplot(CapstoneDF, aes(x=YearQuarters, y=Ratings,col=Year)) +
geom_line(aes(y=RatingsAvg, group=1), linetype="dashed",
colour="black", alpha=0.5) +
stat_summary(aes(size=countQuarters), fun.y=mean, geom="point") +
#coord_cartesian(ylim=c(2.5,4.5)) +
coord_cartesian(ylim=c(3.0,4.5)) +
scale_size_continuous(range=c(3,9)) +
theme(axis.text.x =element_text(angle=90))
global_p2
CapstoneDir = "/Users/Antoine/Documents/Work/DataScience/Springboard/FoundationsofDataScience/CapstoneProject"
setwd(CapstoneDir)
rm(list=ls())
#Set default options for R code chuncks in Markdown.
library(knitr)
opts_chunk$set(tidy=FALSE, message=FALSE, size="small", highlight = TRUE, background=c(0,0,0))
# Function to break long strings up for display
# Source: http://stackoverflow.com/questions/24020617/
#textwrapping-long-string-in-knitr-output-rstudio
str_break = function(x, width = 70L) {
n = nchar(x)
if (n <= width) return(x)
n1 = seq(1L, n, by = width)
n2 = seq(width, n, by = width)
if (n %% width != 0) n2 = c(n2, n)
substring(x, n1, n2)
}
library(rvest)
YelpURL <- "https://www.yelp.ca/biz/reds-midtown-tavern-toronto-2"
YelpURL_data <-read_html(YelpURL)
YelpReviews <- html_nodes(YelpURL_data, ".review-content p")
head(YelpReviews)
YelpReviews_char1 <- as.character(YelpReviews)
head(YelpReviews_char1, n=3)
class(YelpReviews_char1)
YelpReviews_char2 <- html_text(YelpReviews)
head(YelpReviews_char2, n=2)
head(html_attrs(YelpReviews), n=3)
class(html_attrs(YelpReviews))
head(html_attr(YelpReviews, "lang"))
class(html_attr(YelpReviews, "lang"))
YelpRatings <- html_nodes(YelpURL_data, ".rating-large")
as.character(YelpRatings)[1] %>% str_break()
head(html_attrs(YelpRatings), n=3)
YelpRatings_clean <- html_attr(YelpRatings, "title")
head(YelpRatings_clean)
rm(list=ls())
#Load required libraries
library(rvest)
library(dplyr)
library(tidyr)
library(readr)
load("./Data/CapstoneRawData.RData")
#Examine Yelp data
str(YelpData, width=80, strict.width = "cut")
#Examine OpenTable data
str(OpenTableData, width=80, strict.width = "cut")
#Examine TripAdvisor data
str(TripAdData, width=80, strict.width = "cut")
#Examine Zomato data
str(ZomatoData, width=80, strict.width = "cut")
#Which reviews are not previous reviews?
NoPrevRev <- !grepl("has-previous-review",YelpData$PrevRev)
YelpData$Ratings <- YelpData$Ratings[NoPrevRev]
YelpData$Dates <- YelpData$Dates[NoPrevRev]
#Vector, Yelp identifier
YelpVec <- rep("Yelp",length(YelpData$Reviews))
#Combine to data frame
YelpDF <- data_frame(Reviews=YelpData$Reviews,
Ratings=YelpData$Ratings,
Dates=YelpData$Dates,
Website=YelpVec)
#Vector, OpenTable identifier
OpenTableVec <- rep("OpenTable", length(OpenTableData$Reviews))
#Merge to data frame
OpenTableDF <- data_frame(Reviews=OpenTableData$Reviews,
Ratings=OpenTableData$Ratings,
Dates=OpenTableData$Dates,
Website=OpenTableVec)
#Remove NAs from ratings
ZomatoData$Ratings <- ZomatoData$Ratings[!is.na(ZomatoData$Ratings)]
#Remove duplicate reviews. These truncated duplicates can be
# identified with the regex "read more"
FullRev <- !grepl("read more",ZomatoData$Reviews)
ZomatoData$Ratings <- ZomatoData$Ratings[FullRev]
ZomatoData$Reviews <- ZomatoData$Reviews[FullRev]
#Vector, Zomato identifier
ZomatoVec <- rep("Zomato", length(ZomatoData$Reviews))
#Merge to data frame
ZomatoDF <- data_frame(Reviews=ZomatoData$Reviews,
Ratings=ZomatoData$Ratings,
Dates=ZomatoData$Dates,
Website=ZomatoVec)
#Replace dates of the form "Reviewed ## days ago" with the proper dates
TripAdData$Dates2[grepl("ago|yesterday|today",TripAdData$Dates2)] <-
TripAdData$Dates1
##Vector, TripAdvisor identifier
TripAdVec <- rep("TripAdvisor",length(TripAdData$Reviews))
#Merge to data frame
TripAdDF <- data_frame(Reviews=TripAdData$Reviews,
Ratings=TripAdData$Ratings,
Dates=TripAdData$Dates2,
Website=TripAdVec)
#Merge all data frames
d1 <- full_join(YelpDF,OpenTableDF)
d2 <- full_join(d1,ZomatoDF)
CapstoneDF <- full_join(d2,TripAdDF) %>% group_by(Website)
str(CapstoneDF, width=80, strict.width = "cut", give.attr = FALSE)
summary(CapstoneDF)
head(subset(CapstoneDF$Dates, CapstoneDF$Website=="Yelp"),n=10)
#Remove newline characters and spaces
CapstoneDF$Dates <- gsub("\n *","",CapstoneDF$Dates)
head(subset(CapstoneDF$Dates, CapstoneDF$Website=="Yelp"),n=10)
#Find data that doesn't fit Yelp pattern
UncleanDates <- CapstoneDF$Dates[!grepl("^[0-9].*[0-9]$",CapstoneDF$Dates)]
head(UncleanDates, n=10)
#Remove "Updated review"
CapstoneDF$Dates <- gsub("Updated review.*$","", CapstoneDF$Dates)
#Remove "Dined on "
CapstoneDF$Dates <- gsub("Dined on ","",CapstoneDF$Dates)
#OpenTable
head(subset(CapstoneDF$Dates, CapstoneDF$Website=="OpenTable"),n=20)
#TripAdvisor
head(subset(CapstoneDF$Dates, CapstoneDF$Website=="TripAdvisor"),n=20)
#Zomato
head(subset(CapstoneDF$Dates, CapstoneDF$Website=="Zomato"),n=20)
#Remove "Reviewed " from TripAdvisor data
CapstoneDF$Dates <- gsub("Reviewed ","",CapstoneDF$Dates)
head(subset(CapstoneDF$Dates, CapstoneDF$Website=="TripAdvisor"),n=20)
#Yelp date format
head(subset(CapstoneDF$Dates, CapstoneDF$Website=="Yelp"))
#grep for the Yelp dates
YelpDateRegex <- grep("^[0-9]+/.*[0-9]$",CapstoneDF$Dates)
#Express dates as date variables
CapstoneDF$Dates[YelpDateRegex] <-
CapstoneDF$Dates[YelpDateRegex] %>%
as.Date(format="%m/%d/%Y")
#Open Table date format:
head(subset(CapstoneDF$Dates, CapstoneDF$Website=="OpenTable"))
#grep for OpenTable dates and express as date
OpenTableDateRegex <-
grep("^([Jj]|[Ff]|[Mm]|[Aa]|[Jj]|[Ss]|[Oo]|[Nn]|[Dd]).+[0-9]+$",
CapstoneDF$Dates)
CapstoneDF$Dates[OpenTableDateRegex] <-
CapstoneDF$Dates[OpenTableDateRegex] %>%
as.Date(format="%B %d, %Y")
#TripAdvisor date format:
head(subset(CapstoneDF$Dates, CapstoneDF$Website=="TripAdvisor"))
#grep for TripAdvisor dates and express as date variable
TripAdRegex <-
grep("^[0-9]+ ([Jj]|[Ff]|[Mm]|[Aa]|[Jj]|[Ss]|[Oo]|[Nn]|[Dd]).+[0-9]+$",
CapstoneDF$Dates)
CapstoneDF$Dates[TripAdRegex] <-
CapstoneDF$Dates[TripAdRegex] %>%
as.Date(format="%d %B %Y")
CapstoneDF$Dates[which(CapstoneDF$Website == "Zomato")] <-
CapstoneDF$Dates[which(CapstoneDF$Website == "Zomato")] %>%
as.Date()
class(CapstoneDF$Dates) <- "Date"
str(CapstoneDF$Dates)
#Yelp ratings
head(subset(CapstoneDF$Ratings, CapstoneDF$Website=="Yelp"))
#Get rid of "star rating"
CapstoneDF$Ratings <- gsub("star rating","",CapstoneDF$Ratings)
#Open Table ratings
head(subset(CapstoneDF$Ratings, CapstoneDF$Website=="OpenTable"))
#TripAdvisor ratings
head(subset(CapstoneDF$Ratings, CapstoneDF$Website=="TripAdvisor"))
#Get rid of "of 5 bubbles"
CapstoneDF$Ratings <- gsub("of [0-9] bubbles","",CapstoneDF$Ratings)
#Zomato ratings
head(subset(CapstoneDF$Ratings, CapstoneDF$Website=="Zomato"))
#Get rid of "Rated "
CapstoneDF$Ratings <- gsub("Rated ","",CapstoneDF$Ratings)
#Impose numeric class
class(CapstoneDF$Ratings) <- "numeric"
str(CapstoneDF$Ratings)
#Convert Websites to factor
CapstoneDF$Website <-
factor(CapstoneDF$Website,order=FALSE,
levels=c("Yelp","OpenTable","Zomato","TripAdvisor"))
str(CapstoneDF$Website)
levels(CapstoneDF$Website)
#Remove newline characters from reviews
CapstoneDF$Reviews <- gsub("\n","",CapstoneDF$Reviews)
#Clean up Zomato reviews by removing the "Rated" beginning
head(subset(CapstoneDF$Reviews,CapstoneDF$Website=="Zomato"), n=2)
CapstoneDF$Reviews <- gsub(" +Rated *","",CapstoneDF$Reviews)
write_csv(CapstoneDF, "./Data/CapstoneCleanData.csv")
CapstoneDir = "/Users/Antoine/Documents/Work/DataScience/Springboard/FoundationsofDataScience/CapstoneProject"
setwd(CapstoneDir)
rm(list=ls())
#Set default options for R code chuncks in Markdown.
library(knitr)
opts_chunk$set(tidy=FALSE, message=FALSE, size="small", highlight = TRUE, background=c(0,0,0))
# Function to break long strings up for display
# Source: http://stackoverflow.com/questions/24020617/
#textwrapping-long-string-in-knitr-output-rstudio
str_break = function(x, width = 70L) {
n = nchar(x)
if (n <= width) return(x)
n1 = seq(1L, n, by = width)
n2 = seq(width, n, by = width)
if (n %% width != 0) n2 = c(n2, n)
substring(x, n1, n2)
}
library(rvest)
YelpURL <- "https://www.yelp.ca/biz/reds-midtown-tavern-toronto-2"
YelpURL_data <-read_html(YelpURL)
YelpReviews <- html_nodes(YelpURL_data, ".review-content p")
head(YelpReviews)
YelpReviews_char1 <- as.character(YelpReviews)
head(YelpReviews_char1, n=3)
class(YelpReviews_char1)
YelpReviews_char2 <- html_text(YelpReviews)
head(YelpReviews_char2, n=2)
head(html_attrs(YelpReviews), n=3)
class(html_attrs(YelpReviews))
head(html_attr(YelpReviews, "lang"))
class(html_attr(YelpReviews, "lang"))
YelpRatings <- html_nodes(YelpURL_data, ".rating-large")
as.character(YelpRatings)[1] %>% str_break()
head(html_attrs(YelpRatings), n=3)
YelpRatings_clean <- html_attr(YelpRatings, "title")
head(YelpRatings_clean)
rm(list=ls())
#Load required libraries
library(rvest)
library(dplyr)
library(tidyr)
library(readr)
load("./Data/CapstoneRawData.RData")
#Examine Yelp data
str(YelpData, width=80, strict.width = "cut")
#Examine OpenTable data
str(OpenTableData, width=80, strict.width = "cut")
#Examine TripAdvisor data
str(TripAdData, width=80, strict.width = "cut")
#Examine Zomato data
str(ZomatoData, width=80, strict.width = "cut")
#Which reviews are not previous reviews?
NoPrevRev <- !grepl("has-previous-review",YelpData$PrevRev)
YelpData$Ratings <- YelpData$Ratings[NoPrevRev]
YelpData$Dates <- YelpData$Dates[NoPrevRev]
#Vector, Yelp identifier
YelpVec <- rep("Yelp",length(YelpData$Reviews))
#Combine to data frame
YelpDF <- data_frame(Reviews=YelpData$Reviews,
Ratings=YelpData$Ratings,
Dates=YelpData$Dates,
Website=YelpVec)
#Vector, OpenTable identifier
OpenTableVec <- rep("OpenTable", length(OpenTableData$Reviews))
#Merge to data frame
OpenTableDF <- data_frame(Reviews=OpenTableData$Reviews,
Ratings=OpenTableData$Ratings,
Dates=OpenTableData$Dates,
Website=OpenTableVec)
#Remove NAs from ratings
ZomatoData$Ratings <- ZomatoData$Ratings[!is.na(ZomatoData$Ratings)]
#Remove duplicate reviews. These truncated duplicates can be
# identified with the regex "read more"
FullRev <- !grepl("read more",ZomatoData$Reviews)
ZomatoData$Ratings <- ZomatoData$Ratings[FullRev]
ZomatoData$Reviews <- ZomatoData$Reviews[FullRev]
#Vector, Zomato identifier
ZomatoVec <- rep("Zomato", length(ZomatoData$Reviews))
#Merge to data frame
ZomatoDF <- data_frame(Reviews=ZomatoData$Reviews,
Ratings=ZomatoData$Ratings,
Dates=ZomatoData$Dates,
Website=ZomatoVec)
#Replace dates of the form "Reviewed ## days ago" with the proper dates
TripAdData$Dates2[grepl("ago|yesterday|today",TripAdData$Dates2)] <-
TripAdData$Dates1
##Vector, TripAdvisor identifier
TripAdVec <- rep("TripAdvisor",length(TripAdData$Reviews))
#Merge to data frame
TripAdDF <- data_frame(Reviews=TripAdData$Reviews,
Ratings=TripAdData$Ratings,
Dates=TripAdData$Dates2,
Website=TripAdVec)
#Merge all data frames
d1 <- full_join(YelpDF,OpenTableDF)
d2 <- full_join(d1,ZomatoDF)
CapstoneDF <- full_join(d2,TripAdDF) %>% group_by(Website)
str(CapstoneDF, width=80, strict.width = "cut", give.attr = FALSE)
summary(CapstoneDF)
head(subset(CapstoneDF$Dates, CapstoneDF$Website=="Yelp"),n=10)
#Remove newline characters and spaces
CapstoneDF$Dates <- gsub("\n *","",CapstoneDF$Dates)
head(subset(CapstoneDF$Dates, CapstoneDF$Website=="Yelp"),n=10)
#Find data that doesn't fit Yelp pattern
UncleanDates <- CapstoneDF$Dates[!grepl("^[0-9].*[0-9]$",CapstoneDF$Dates)]
head(UncleanDates, n=10)
#Remove "Updated review"
CapstoneDF$Dates <- gsub("Updated review.*$","", CapstoneDF$Dates)
#Remove "Dined on "
CapstoneDF$Dates <- gsub("Dined on ","",CapstoneDF$Dates)
#OpenTable
head(subset(CapstoneDF$Dates, CapstoneDF$Website=="OpenTable"),n=20)
#TripAdvisor
head(subset(CapstoneDF$Dates, CapstoneDF$Website=="TripAdvisor"),n=20)
#Zomato
head(subset(CapstoneDF$Dates, CapstoneDF$Website=="Zomato"),n=20)
#Remove "Reviewed " from TripAdvisor data
CapstoneDF$Dates <- gsub("Reviewed ","",CapstoneDF$Dates)
head(subset(CapstoneDF$Dates, CapstoneDF$Website=="TripAdvisor"),n=20)
#Yelp date format
head(subset(CapstoneDF$Dates, CapstoneDF$Website=="Yelp"))
#grep for the Yelp dates
YelpDateRegex <- grep("^[0-9]+/.*[0-9]$",CapstoneDF$Dates)
#Express dates as date variables
CapstoneDF$Dates[YelpDateRegex] <-
CapstoneDF$Dates[YelpDateRegex] %>%
as.Date(format="%m/%d/%Y")
#Open Table date format:
head(subset(CapstoneDF$Dates, CapstoneDF$Website=="OpenTable"))
#grep for OpenTable dates and express as date
OpenTableDateRegex <-
grep("^([Jj]|[Ff]|[Mm]|[Aa]|[Jj]|[Ss]|[Oo]|[Nn]|[Dd]).+[0-9]+$",
CapstoneDF$Dates)
CapstoneDF$Dates[OpenTableDateRegex] <-
CapstoneDF$Dates[OpenTableDateRegex] %>%
as.Date(format="%B %d, %Y")
#TripAdvisor date format:
head(subset(CapstoneDF$Dates, CapstoneDF$Website=="TripAdvisor"))
#grep for TripAdvisor dates and express as date variable
TripAdRegex <-
grep("^[0-9]+ ([Jj]|[Ff]|[Mm]|[Aa]|[Jj]|[Ss]|[Oo]|[Nn]|[Dd]).+[0-9]+$",
CapstoneDF$Dates)
CapstoneDF$Dates[TripAdRegex] <-
CapstoneDF$Dates[TripAdRegex] %>%
as.Date(format="%d %B %Y")
CapstoneDF$Dates[which(CapstoneDF$Website == "Zomato")] <-
CapstoneDF$Dates[which(CapstoneDF$Website == "Zomato")] %>%
as.Date()
class(CapstoneDF$Dates) <- "Date"
str(CapstoneDF$Dates)
#Yelp ratings
head(subset(CapstoneDF$Ratings, CapstoneDF$Website=="Yelp"))
#Get rid of "star rating"
CapstoneDF$Ratings <- gsub("star rating","",CapstoneDF$Ratings)
#Open Table ratings
head(subset(CapstoneDF$Ratings, CapstoneDF$Website=="OpenTable"))
#TripAdvisor ratings
head(subset(CapstoneDF$Ratings, CapstoneDF$Website=="TripAdvisor"))
#Get rid of "of 5 bubbles"
CapstoneDF$Ratings <- gsub("of [0-9] bubbles","",CapstoneDF$Ratings)
#Zomato ratings
head(subset(CapstoneDF$Ratings, CapstoneDF$Website=="Zomato"))
#Get rid of "Rated "
CapstoneDF$Ratings <- gsub("Rated ","",CapstoneDF$Ratings)
#Impose numeric class
class(CapstoneDF$Ratings) <- "numeric"
str(CapstoneDF$Ratings)
#Convert Websites to factor
CapstoneDF$Website <-
factor(CapstoneDF$Website,order=FALSE,
levels=c("Yelp","OpenTable","Zomato","TripAdvisor"))
str(CapstoneDF$Website)
levels(CapstoneDF$Website)
#Remove newline characters from reviews
CapstoneDF$Reviews <- gsub("\n","",CapstoneDF$Reviews)
#Clean up Zomato reviews by removing the "Rated" beginning
head(subset(CapstoneDF$Reviews,CapstoneDF$Website=="Zomato"), n=2)
CapstoneDF$Reviews <- gsub(" +Rated *","",CapstoneDF$Reviews)
write_csv(CapstoneDF, "./Data/CapstoneCleanData.csv")
#Load libraries
library(readr)
library(dplyr)
library(tidyr)
library(tm)
library(wordcloud)
library(ggplot2)
library(syuzhet)
#Read in clean data
CapstoneDF <- read_csv("./Data/CapstoneCleanData.csv")
#Summary of data frame
glimpse(CapstoneDF)
#Create variable describing annual quarters: Quarters
CapstoneDF <- CapstoneDF  %>% mutate(Quarters = quarters.Date(Dates))
#Separate Dates variable into Year, Month, Day variables
CapstoneDF <- CapstoneDF %>% separate(Dates, c("Year","Month","Day"))
#Create variable that describes Month and Year together: YearMonth
tempdf <- CapstoneDF %>% unite("YearMonth", Year, Month, sep="-")
CapstoneDF$YearMonth <- tempdf$YearMonth
#Create variable that describes Quarters and Year together: YearQuarters
tempdf <- CapstoneDF %>% unite("YearQuarters", Year, Quarters, sep="-")
CapstoneDF$YearQuarters <- tempdf$YearQuarters
#Convert Website and Quarters to factor class
CapstoneDF$Website <- factor(CapstoneDF$Website)
CapstoneDF$Quarters <- factor(CapstoneDF$Quarters)
t1 <- CapstoneDF %>% group_by(Year) %>% summarise(countYear=n())
CapstoneDF <- left_join(CapstoneDF,t1, by="Year")
t2 <- CapstoneDF %>% group_by(YearQuarters) %>% summarise(countQuarters=n())
CapstoneDF <- left_join(CapstoneDF,t2, by="YearQuarters")
t3 <- CapstoneDF %>% group_by(YearMonth) %>% summarise(countMonth=n())
CapstoneDF <- left_join(CapstoneDF,t3, by="YearMonth")
head(CapstoneDF[-1])
mean(CapstoneDF$Ratings)
CapstoneDF$RatingsAvg <-
rep(mean(CapstoneDF$Ratings), length(CapstoneDF$Ratings))
#Ratings aggregated by Year
global_p1 <- ggplot(CapstoneDF, aes(x=Year, y=Ratings)) +
geom_line(aes(y=RatingsAvg, group=1), linetype="dashed",
colour="red", alpha=0.5) +
stat_summary(aes(size=countYear), fun.y=mean, geom="point") +
#coord_cartesian(ylim=c(2.5,4.5)) +
scale_size_continuous(range=c(3,7)) +
coord_cartesian(ylim=c(3.0,4.5))
global_p1
#Ratings aggregated by Year and Quarters
global_p2 <- ggplot(CapstoneDF, aes(x=YearQuarters, y=Ratings,col=Year)) +
geom_line(aes(y=RatingsAvg, group=1), linetype="dashed",
colour="black", alpha=0.5) +
stat_summary(aes(size=countQuarters), fun.y=mean, geom="point") +
#coord_cartesian(ylim=c(2.5,4.5)) +
coord_cartesian(ylim=c(3.0,4.5)) +
scale_size_continuous(range=c(3,9)) +
theme(axis.text.x =element_text(angle=90))
global_p2
CapstoneDF$QuarterGroup <- rep(0, dim(CapstoneDF)[1])
CapstoneDF$QuarterGroup[CapstoneDF$YearQuarters %in% c("2013-Q4", "2014-Q1", "2014-Q3", "2014-Q4")] <- "Mid"
CapstoneDF$QuarterGroup[CapstoneDF$YearQuarters %in% c("2015-Q2", "2015-Q3", "2015-Q4", "2016-Q1")] <- "Poor"
CapstoneDF$QuarterGroup[CapstoneDF$YearQuarters %in% c("2016-Q2", "2016-Q3", "2016-Q4", "2017-Q1")] <- "Growth"
CapstoneDF$QuarterGroup[CapstoneDF$YearQuarters %in% c("2014-Q2", "2015-Q1")] <- "Outliers"
CapstoneDF$QuarterGroup <- factor(CapstoneDF$QuarterGroup)
#Ratings aggregated by Year and Quarters
global_p3 <- ggplot(CapstoneDF, aes(x=YearQuarters, y=Ratings,col=QuarterGroup)) +
geom_line(aes(y=RatingsAvg, group=1), linetype="dashed",
colour="black", alpha=0.5) +
stat_summary(aes(size=countQuarters),fun.y=mean, geom="point") +
#coord_cartesian(ylim=c(2.5,4.5)) +
coord_cartesian(ylim=c(3.0,4.5)) +
scale_size_continuous(range=c(3,9)) +
theme(axis.text.x =element_text(angle=90))
global_p3
global_p4 <- ggplot(CapstoneDF, aes(x=YearMonth, y=Ratings, col=Year)) +
geom_line(aes(y=RatingsAvg, group=1), linetype="dashed",
colour="black", alpha=0.5) +
stat_summary(aes(size=countMonth),fun.y=mean, geom="point", alpha=0.8) +
coord_cartesian(ylim=c(2.5,4.5)) +
scale_size_continuous(range=c(3,8)) +
theme(axis.text.x =element_text(angle=90))
global_p4
